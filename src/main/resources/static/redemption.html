<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" href="pics/humbleicons--coffee.svg" type="image/x-icon">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pandora Helper</title>
    <style>
        button {
            background-color: #43cea2;
            color: #fff;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9em;
            font-weight: 600;
        }

        button:hover {
            background-color: #2980b9;
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        body, html {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            height: 100%;
            background-color: #f5f5f5;
        }

        .container {
            display: flex;
            height: 100%;
        }

        .sidebar {
            width: 220px;
            background-color: #ffffff;
            padding: 20px;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            position: fixed; /* 固定导航栏 */
            height: 100%; /* 确保导航栏占满左侧高度 */
        }

        .sidebar h2 {
            color: #0e8f6f;
            margin-bottom: 20px;
            font-size: 22px;
        }

        .sidebar ul {
            list-style-type: none;
            padding: 0;
        }

        .sidebar li {
            margin-bottom: 15px;
        }

        .sidebar a {
            color: #333;
            text-decoration: none;
            font-size: 18px;
            display: block;
            padding: 10px 15px;
            border-radius: 4px;
            transition: background-color 0.3s, color 0.3s;
        }

        .sidebar a:hover, .sidebar a.active {
            background-color: #0e8f6f;
            color: #fff;
        }

        .main-content {
            margin-left: 240px; /* 确保内容部分从导航栏右侧开始 */
            padding: 20px;
            flex-grow: 1;
        }

        .panel {
            background-color: #ffffff;
            border-radius: 5px;
            padding: 15px;
            margin-left: 20px;
            height: 750px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .search-bar {
            display: flex;
            margin-bottom: 20px;
        }

        .search-bar input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px 0 0 4px;
        }

        .search-bar button {
            padding: 10px 20px;
            background-color: #0e8f6f;
            color: white;
            border: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #f2f2f2;
        }

        .action-buttons button {
            margin-right: 5px;
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .refresh-btn {
            background-color: #0e8f6f;
            color: white;
        }

        .open-share-btn {
            background-color: #0e8f6f;
            color: white;
        }

        .distribute-claude-btn {
            background-color: #6fafd2;
            color: white;
        }

        .distribute-gpt-btn {
            background-color: #43cea2;
            color: white;
        }

        .update-parent-btn {
            background-color: #f0ad99;
            color: white;
        }

        .edit-btn {
            background-color: #f0ad4e;
            color: white;
        }

        .delete-btn {
            background-color: #d9534f;
            color: white;
        }

        .create-new {
            float: right;
            padding: 10px 20px;
            background-color: #0e8f6f;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 20px;
        }

        /*.modal {*/
        /*    display: none;*/
        /*    position: fixed;*/
        /*    z-index: 1;*/
        /*    left: 0;*/
        /*    top: 0;*/
        /*    width: 100%;*/
        /*    height: 100%;*/
        /*    overflow: auto;*/
        /*    background-color: rgba(0, 0, 0, 0.4);*/
        /*}*/

        .modal-content {
            background-color: #fefefe;
            padding: 20px;
            border: 1px solid #888;
            width: auto; /* 适应内容宽度 */
            max-width: 500px; /* 最大宽度 */
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        @media (max-width: 600px) {
            .modal-content {
                max-width: 90%; /* 在小屏幕上占更大比例的宽度 */
            }
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        .ellipsis {
            max-width: 120px; /* 设置最大宽度，根据实际需求调整 */
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            display: block; /* 确保应用block布局 */
        }

        .share-ellipsis {
            max-width: 150px; /* 设置最大宽度，根据实际需求调整 */
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            display: block; /* 确保应用block布局 */
        }

        .modal {
            display: none;
            justify-content: center; /* 水平居中 */
            align-items: center; /* 垂直居中 */
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }

        form {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            width: 300px;
        }

        label {
            display: block;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            color: #666;
        }

        input[type="email"],
        input[type="password"],
        input[type="text"] {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            margin-top: 1rem;
        }

        .checkbox-container label {
            margin-top: 0;
            margin-left: 0.5rem;
        }

        .tanchuang-button {
            display: block;
            width: 100%;
            padding: 0.75rem;
            background-color: #0e8f6f;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 1.5rem;
            font-size: 1rem;
        }

        /* 基本开关样式 */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        /* 隐藏默认的复选框 */
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        /* 滑块样式 */
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        /* 滑块::before 伪元素样式 */
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        /* 检查复选框是否被选中，更改滑块颜色 */
        input:checked + .slider {
            background-color: #2196F3;
        }

        /* 检查复选框是否被选中，移动滑块位置 */
        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* 可选：增加鼠标悬停效果 */
        .slider:hover {
            background-color: #7b7b7b;
        }

        #add-type {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        #configSelect {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .clickable {
            cursor: pointer;
        }

        tbody {
            font-size: 0.95em;
        }

        tbody tr {
            transition: all 0.2s ease-in-out;
            border-radius: 4px;
        }

        tbody tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        tbody tr:hover {
            background-color: #e9ecef;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        tbody td {
            padding: 12px 15px;
            vertical-align: middle;
            border-bottom: 1px solid #dee2e6;
            transition: all 0.2s ease-in-out;
        }

        tbody tr:last-child td {
            border-bottom: none;
        }

        tbody td:first-child {
            font-weight: 500;
            color: #495057;
        }

        /*tbody td:not(:first-child) {*/
        /*    color: #6c757d;*/
        /*}*/

        tbody td:last-child {
            text-align: left;
        }

        /* 为长文本添加省略号 */
        tbody td.truncate {
            max-width: 200px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* 为状态类的列添加特殊样式 */
        tbody td.status {
            font-weight: 600;
        }

        tbody td.status-active {
            color: #28a745;
        }

        tbody td.status-inactive {
            color: #dc3545;
        }

        /* 为操作按钮添加样式 */
        tbody td .action-btn {
            padding: 6px 12px;
            border-radius: 4px;
            background-color: #007bff;
            color: white;
            text-decoration: none;
            font-size: 0.9em;
            transition: background-color 0.2s ease-in-out;
        }

        tbody td .action-btn:hover {
            background-color: #0056b3;
        }

        /* 表格整体样式 */
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-bottom: 1rem;
            font-size: 0.9em;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
        }

        /* 表头样式 */
        thead {
            background-color: #f5f5f5;
        }

        thead tr {
            background-color: #f5f5f5;
            color: #333;
            text-align: left;
            font-weight: bold;
        }

        thead th {
            padding: 12px 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        /* 表格行样式 */
        tr {
            border-bottom: 1px solid #e0e0e0;
        }

        tr:last-child {
            border-bottom: none;
        }

        tbody tr:nth-child(even) {
            background-color: #fafafa;
        }

        tbody tr:hover {
            background-color: #f0f0f0;
            transition: background-color 0.3s ease;
        }

        /* 表格单元格样式 */
        td, th {
            padding: 12px 15px;
            text-align: left;
        }

        /* 首列样式 */
        td:first-child, th:first-child {
            padding-left: 20px;
        }

        /* 末列样式 */
        td:last-child, th:last-child {
            padding-right: 20px;
        }

        /* 状态样式 */
        .status {
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: bold;
        }

        .status-active {
            background-color: #e8f5e9;
            color: #2e7d32;
        }

        .status-inactive {
            background-color: #ffebee;
            color: #c62828;
        }

        /* 操作按钮样式 */
        .action-btn {
            padding: 6px 12px;
            border-radius: 4px;
            background-color: #2196f3;
            color: white;
            text-decoration: none;
            font-size: 0.9em;
            transition: background-color 0.2s ease-in-out;
        }

        .action-btn:hover {
            background-color: #1976d2;
        }

        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .pagination button {
            margin: 0 5px;
            padding: 5px 10px;
            cursor: pointer;
        }

        #accountSelect {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 2px;
            box-sizing: border-box;
        }
        .user-menu {
            position: absolute;
            bottom: 0px;
            top: 94%;
            left: 0.8%;

        }
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #3498db;
            cursor: pointer;
            overflow: hidden;
        }
        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .dropdown {
            display: none;
            position: absolute;
            top: -92%;
            left: 120%;
            background-color: #fff;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 4px;
            overflow: hidden;
            z-index: 1000;
        }

        .dropdown a {
            display: block;
            padding: 10px 20px;
            color: #333;
            text-decoration: none;
            white-space: nowrap;
        }
        .user-avatar:hover + .dropdown,
        .dropdown:hover {
            display: block;
        }

        .dropdown a:hover {
            background-color: #f4f4f4;
        }

    </style>
</head>
<body>

<div class="container">
    <div class="sidebar">
        <h2>Pandora Helper</h2>
        <ul>
            <li><a href="#" id="accountNav">账号管理</a></li>
            <li><a href="#" id="shareNav">分享管理</a></li>
            <li><a href="#" id="redemptionNav"  class="active">兑换码</a></li>
            <li><a href="#" id="carNav">停车场</a></li>
        </ul>
    </div>
    <div class="main-content">
        <div class="user-menu">
            <div class="user-avatar">
                <img id="avatar" src="/pics/linuxdo.webp" alt="User Avatar">
            </div>
            <div class="dropdown">
                <a href="#" onclick="openModal('activateRedemptionModal')">兑换码激活</a>
                <a href="#" onclick="logout()">退出登录</a>
            </div>
        </div>
        <div id="redemptionPanel" class="panel">
            <h2>兑换码管理</h2>
            <div class="search-bar">
                <input id="email-query" type="email-query" placeholder="Email">
                <button onclick="emailQuery()">查询</button>
            </div>
            <button class="create-new" onclick="openModalRedemption('redemptionModal')">新增</button>
            <table>
                <thead>
                <tr>
                    <th>邮箱</th>
                    <!--                    <th>密码</th>-->
                    <th>账号类型</th>
                    <th>兑换码</th>
                    <th>兑换时长</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody id="redemptionTableBody">

                </tbody>

            </table>
            <div class="pagination">
                <button id="redemptionPrevBtn">上一页</button>
                <span id="redemptionPageInfo"></span>
                <button id="redemptionNextBtn">下一页</button>
            </div>
        </div>
    </div>
</div>

<div id="activateRedemptionModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('activateRedemptionModal')">&times;</span>
        <h2>兑换码</h2>
        <form style="padding-top: 20px; padding-bottom: 20px">

<!--            <label for="activate-redemption">兑换码：</label>-->
            <input type="text" id="activate-redemption" name="update-limit">

            <button class="tanchuang-button" type="button" onclick="redemptionActivate()">保存</button>
        </form>
    </div>
</div>


<div id="redemptionModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('redemptionModal')">&times;</span>
        <h2>新增兑换码</h2>
        <form style="padding-top: 20px; padding-bottom: 20px">
            <label for="accountSelect">账号</label>
            <select id="accountSelect" name="accountSelect" required>
            </select>
            <label for="add-duration">兑换时长(天)</label>
            <input type="text" id="add-duration" name="add-duration">

            <label for="add-redemption-count">兑换码数量</label>
            <input type="text" id="add-redemption-count" name="add-redemption-count">

            <button class="tanchuang-button" type="button" onclick="addRedemption()">保存</button>
        </form>
    </div>
</div>

<div id="redemptionUpdateModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('redemptionUpdateModal')">&times;</span>
        <h2>修改账号</h2>
        <form style="padding-top: 20px; padding-bottom: 20px">
            <input type="hidden" id="update-red-id" name="redId">

            <label for="update-duration">兑换时长(天)</label>
            <input type="text" id="update-duration" name="update-duration">

            <button class="tanchuang-button" type="button" onclick="updateRedemption()">保存</button>
        </form>
    </div>
</div>

<script type="text/javascript">
    function fetchApplies() {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", "/account/list", true);
        xhr.setRequestHeader('Authorization', "Bearer " + localStorage.getItem('token'));
        xhr.onreadystatechange = function () {
            if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
                var options = JSON.parse(xhr.responseText).data;
                var select = document.getElementById('accountSelect');
                select.innerHTML = ''; // 清空现有选项

                // let optEmpty = document.createElement('option');
                // optEmpty.value = '-1'
                // optEmpty.label = '-';
                // optEmpty.innerHTML =
                //     select.appendChild(optEmpty);

                options.forEach(function (option) {
                    var opt = document.createElement('option');
                    opt.value = option.id;
                    opt.innerHTML = option.email + " (" + option.type + ")";
                    select.appendChild(opt);
                });
            }
        };
        xhr.send();
    }

    function redemptionActivate() {
        code = document.getElementById('activate-redemption').value
        var xhr = new XMLHttpRequest();
        xhr.open("GET", "/redemption/activate?code=" + code, true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.setRequestHeader('Authorization', "Bearer " + localStorage.getItem('token'));
        // 设置body
        xhr.onreadystatechange = function () {
            if (xhr.readyState === XMLHttpRequest.DONE) {
                closeModal('activateRedemptionModal')
                let data = JSON.parse(xhr.responseText);
                if (data.status) {
                    alert("激活成功")
                } else {
                    alert(data.message);
                }
            }
        }
        xhr.send();
    }

    function addRedemption() {
        let accountId = parseInt(document.getElementById('accountSelect').value);
        let duration = parseInt(document.getElementById('add-duration').value);
        let count = parseInt(document.getElementById('add-redemption-count').value);
        let xhr = new XMLHttpRequest();
        xhr.open("POST", "/redemption/add", true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.setRequestHeader('Authorization', "Bearer " + localStorage.getItem('token'));
        // 设置body
        xhr.onreadystatechange = function () {
            if (xhr.readyState === XMLHttpRequest.DONE) {
                closeModal('redemptionModal')
                let data = JSON.parse(xhr.responseText)
                if (data.status) {
                    alert("添加成功")
                    fetchRedemptions('')
                    document.getElementById('add-duration').value = '';
                    document.getElementById('add-redemption-count').value = ''
                } else {
                    alert(data.message);
                }
            }
        }
        xhr.send(JSON.stringify({
            duration: duration,
            count: count,
            accountId: accountId,
        }));

    }

    function updateRedemption() {
        let duration = parseInt(document.getElementById('update-duration').value);
        let id = parseInt(document.getElementById('update-red-id').value);
        let xhr = new XMLHttpRequest();
        xhr.open("PATCH", "/redemption/update", true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.setRequestHeader('Authorization', "Bearer " + localStorage.getItem('token'));
        // 设置body
        xhr.onreadystatechange = function () {
            if (xhr.readyState === XMLHttpRequest.DONE) {
                closeModal('redemptionModal')
                if (xhr.status === 200) {
                    closeModal('redemptionUpdateModal')
                    alert("更新成功")
                    fetchRedemptions('')
                    document.getElementById('update-duration').value = '';
                    document.getElementById('update-red-id').value = '';
                } else {
                    alert("更新失败");
                }
            }
        }
        xhr.send(JSON.stringify({
            id: id,
            duration: duration
        }));

    }


    async function fetchRedemptions(email) {

        const tableBody = document.getElementById('redemptionTableBody');

        const startIndex = (curRedemptionPage - 1) * 8;
        const endIndex = startIndex + 8;

        var xhr = new XMLHttpRequest();
        xhr.open("GET", "/redemption/list?emailAddr=" + email, true);
        xhr.setRequestHeader('Authorization', "Bearer " + localStorage.getItem('token'));
        xhr.onreadystatechange = function () {
            if (xhr.readyState === XMLHttpRequest.DONE) {
                if (xhr.status === 200) {
                    const res = JSON.parse(xhr.responseText);
                    tableBody.innerHTML = ''; // 清空现有的表格内容
                    redemptionTotal = res.data.length
                    const pageData = res.data.slice(startIndex, endIndex);

                    pageData.forEach(redemption => {
                        const row = `
                <tr>
                    <td>${redemption.email}</td>
                    <td><div class="ellipsis">${redemption.accountType}</div></td>
                    <td><div class="ellipsis">${redemption.code}</div></td>
                    <td>${redemption.duration}</td>
                    <td>
                        <button class="edit-btn" onclick="editRedemption('${redemption.id}', '${redemption.duration}')">Edit</button>
                        <button class="delete-btn" onclick="deleteRedemption('${redemption.id}')">Delete</button>
                    </td>
                </tr>
            `;
                        tableBody.innerHTML += row;
                        updateRedemptionPagination();
                    });
                }
            }
        }
        xhr.send()
    }

    let curRedemptionPage = 1;
    let redemptionTotal = 0;


    function editRedemption(id, duration) {
        openModalCustom('redemptionUpdateModal', id, duration)
    }

    function deleteRedemption(redemptionId) {
        var xhr = new XMLHttpRequest();
        xhr.open("DELETE", "/redemption/delete?id=" + redemptionId, true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.setRequestHeader('Authorization', "Bearer " + localStorage.getItem('token'));
        // 设置body
        xhr.onreadystatechange = function () {
            if (xhr.readyState === XMLHttpRequest.DONE) {
                closeModal('redemptionModal')
                if (xhr.status === 200) {
                    alert("删除成功")
                    fetchRedemptions('')
                } else {
                    alert("删除失败");
                }
            }
        }
        xhr.send(JSON.stringify({
            id: redemptionId
        }));
    }

    async function loadImg() {
        if (localStorage.getItem('img')) {
            document.getElementById('avatar').src = localStorage.getItem('img')
        }
    }

    window.onload = async function () {
        const token = localStorage.getItem('token');
        if (token) {
            var xhr = new XMLHttpRequest();
            xhr.open("GET", "/user/checkToken", true);
            xhr.setRequestHeader('Authorization', "Bearer " + token);
            xhr.onreadystatechange = function () {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                        const res = JSON.parse(xhr.responseText);
                        if (res.data) {
                            localStorage.setItem("token", token)
                            fetchRedemptions('')
                            return true
                        } else {
                            alert(res.message);
                            window.location.href = 'index.html';
                        }
                    }
                }
            }
            xhr.send()
        } else {
            // 如果没有授权信息，跳转到登录页面
            alert('未监测到登录状态,请登录');
            window.location.href = 'index.html';
        }

        await loadImg()

    }

    function openModal(modalId) {
        document.getElementById(modalId).style.display = 'flex';
    }

    function openModalRedemption(modalId) {
        fetchApplies(); // 获取配置选项
        document.getElementById(modalId).style.display = 'flex';
    }

    function openModalCustom(modalId, id, duration) {
        document.getElementById(modalId).style.display = 'flex';
        const redId = document.getElementById('update-red-id')
        const redDuration = document.getElementById('update-duration')

        redId.value = id;
        redDuration.value = duration;
    }

    function emailQuery() {
        const email = document.getElementById('email-query')
        fetchRedemptions(email.value)
    }

    function closeModal(modalId) {
        document.getElementById(modalId).style.display = "none";
    }

    document.getElementById('accountNav').addEventListener('click', async function () {
        window.location.href = 'account.html';
    });

    document.getElementById('shareNav').addEventListener('click', async function () {
        window.location.href = 'share.html';
    });

    document.getElementById('carNav').addEventListener('click', async function () {
        window.location.href = 'car.html';
    });

    document.getElementById('redemptionNav').addEventListener('click', async function () {
        await fetchRedemptions('')
    });


    function updateRedemptionPagination() {
        const pageInfo = document.getElementById('redemptionPageInfo');
        const totalPages = Math.ceil(redemptionTotal / 8);
        pageInfo.textContent = `第 ${curRedemptionPage} 页，共 ${totalPages} 页`;

        document.getElementById('redemptionPrevBtn').disabled = curRedemptionPage === 1;
        document.getElementById('redemptionNextBtn').disabled = curRedemptionPage === totalPages;
    }

    document.getElementById('redemptionPrevBtn').addEventListener('click', () => {
        let email = document.getElementById('email-query').value
        if (curRedemptionPage > 1) {
            curRedemptionPage--;
            fetchRedemptions(email === undefined ? '' : email);
        }
    });

    document.getElementById('redemptionNextBtn').addEventListener('click', () => {
        let email = document.getElementById('email-query').value
        const totalPages = Math.ceil(redemptionTotal / 8);
        if (curRedemptionPage < totalPages) {
            curRedemptionPage++;
            fetchRedemptions(email === undefined ? '' : email);
        }
    });


    let timeout;
    const userMenu = document.querySelector('.user-menu');
    const dropdown = document.querySelector('.dropdown');

    userMenu.addEventListener('mouseenter', () => {
        clearTimeout(timeout);
        dropdown.style.display = 'block';
    });

    userMenu.addEventListener('mouseleave', () => {
        timeout = setTimeout(() => {
            dropdown.style.display = 'none';
        }, 300); // 300ms 延迟
    });

    dropdown.addEventListener('mouseenter', () => {
        clearTimeout(timeout);
    });

    dropdown.addEventListener('mouseleave', () => {
        timeout = setTimeout(() => {
            dropdown.style.display = 'none';
        }, 300); // 300ms 延迟
    });


    function logout() {
        window.location.href = 'index.html'
        localStorage.removeItem('token')
        localStorage.removeItem('img')
    }

</script>
</body>
</html>


